import os
import json
import xml.etree.ElementTree as ET

input_folder = "./public/kanji"
output_file = "./public/radicals_to_kanji_map.json"

radical_map = {}

joyo_kanji_set = {'羨', '噴', '砲', '神', '陰', '松', '買', '貫', '携', '歯', '削', '大', '倍', '払', '謹', '彩', '惰', '葛', '縮', '畳', '題', '私', '術', '容', '競', '黙', '胸', '場', '弦', '調', '志', '蓄', '耐', '応', '偉', '堕', '悠', '監', '構', '詔', '演', '趣', '朽', '摯', '能', '芯', '伸', '麓', '渇', '没', '豊', '隊', '赦', '葉', '囲', '洪', '懸', '抄', '虞', '解', '津', '着', '梨', '封', '靴', '味', '玩', '細', '彙', '控', '酸', '立', '掲', '技', '軍', '暴', '興', '岬', '枝', '落', '葬', '息', '併', '斬', '損', '踏', '賢', '進', '附', '純', '沙', '究', '殴', '磁', '産', '元', '肖', '塡', '第', '雰', '形', '登', '律', '襲', '辣', '血', '十', '学', '袋', '迷', '役', '冠', '少', '環', '芸', '奇', '過', '粘', '喫', '災', '北', '射', '正', '蒸', '蜜', '厳', '奏', '助', '具', '擦', '板', '陳', '季', '諮', '舌', '塚', '疎', '暦', '犬', '繕', '乏', '給', '見', '煎', '逝', '懲', '議', '鏡', '預', '糾', '繊', '椅', '鹿', '妻', '坊', '償', '吟', '出', '丼', '質', '耳', '佐', '練', '抵', '参', '杉', '旋', '受', '嘆', '駒', '憶', '薄', '広', '鎮', '麻', '奈', '唾', '伺', '腎', '力', '娯', '月', '合', '診', '藻', '君', '寮', '鳴', '楼', '加', '屯', '軸', '慣', '図', '開', '筒', '捗', '眠', '呉', '枢', '詞', '厄', '双', '欠', '孤', '複', '箇', '傍', '秀', '奴', '熊', '仮', '怖', '消', '範', '飲', '率', '錯', '菜', '塗', '局', '脱', '誌', '致', '刷', '殊', '裸', '挟', '行', '若', '粒', '天', '荘', '皿', '憬', '拉', '唄', '起', '空', '乗', '小', '白', '旺', '西', '賦', '甘', '整', '忌', '訟', '版', '暇', '患', '炉', '映', '愚', '叙', '稚', '蛍', '蔵', '畑', '鎖', '納', '布', '倫', '矢', '浴', '璃', '互', '艇', '塊', '原', '鯨', '扉', '韓', '渋', '膜', '堪', '暫', '労', '凝', '訂', '尺', '薦', '飯', '隻', '回', '勇', '驚', '室', '曽', '戸', '裏', '跳', '由', '許', '示', '庭', '猟', '更', '奪', '疲', '東', '惜', '弟', '連', '朱', '七', '催', '汁', '漠', '除', '鉢', '束', '架', '違', '区', '圧', '殿', '花', '伝', '突', '専', '娠', '判', '阻', '玄', '鍵', '泳', '前', '郡', '陪', '棚', '露', '尊', '為', '透', '様', '賜', '鳥', '循', '普', '例', '疾', '宣', '堆', '公', '房', '姉', '梗', '徹', '球', '度', '凡', '盗', '考', '町', '個', '創', '膝', '火', '駅', '傷', '汎', '都', '既', '遍', '煮', '皆', '貼', '象', '宅', '漬', '錬', '逐', '紳', '梅', '湯', '掌', '去', '奥', '井', '癒', '港', '団', '完', '黄', '激', '自', '右', '茶', '刺', '列', '読', '秩', '浜', '酷', '懐', '刻', '拡', '隆', '顎', '潟', '高', '麦', '瀬', '仲', '楽', '帯', '亡', '千', '絡', '窒', '努', '藤', '際', '濯', '市', '獄', '塔', '付', '窯', '旅', '鮮', '族', '旦', '卵', '責', '浦', '巨', '業', '悦', '寂', '跡', '敢', '久', '貞', '宙', '運', '乳', '卒', '幸', '青', '凄', '勢', '琴', '狩', '威', '得', '級', '汰', '降', '撤', '随', '首', '折', '限', '嬢', '伐', '誉', '浄', '弁', '造', '疑', '男', '壱', '追', '栽', '士', '銭', '戦', '冬', '涯', '統', '妖', '施', '免', '色', '啓', '租', '焦', '雲', '貨', '峰', '薪', '括', '齢', '幾', '俳', '駄', '常', '狙', '病', '覆', '悩', '唐', '竹', '在', '像', '眺', '紙', '敷', '甲', '盾', '積', '昆', '昧', '昼', '勧', '半', '非', '階', '臭', '密', '硫', '担', '尉', '湖', '会', '住', '錠', '六', '未', '祉', '銘', '余', '捻', '粛', '液', '遣', '顧', '冊', '岳', '省', '咲', '農', '以', '謁', '端', '滞', '口', '牧', '越', '襟', '裂', '乙', '均', '観', '拭', '置', '編', '匠', '濁', '譜', '馬', '愉', '嘲', '即', '媛', '釣', '占', '四', '慕', '面', '台', '代', '偶', '闘', '埋', '尻', '権', '頒', '肥', '美', '聖', '背', '庁', '溝', '弧', '害', '糖', '涼', '借', '穏', '懇', '岐', '格', '頰', '遅', '今', '筆', '異', '詮', '帳', '盟', '真', '謄', '寛', '該', '優', '栓', '坑', '灯', '詳', '育', '効', '骸', '慮', '話', '振', '王', '泰', '案', '側', '路', '説', '逃', '鬼', '牲', '税', '絹', '尼', '妨', '碑', '近', '載', '億', '慌', '刃', '把', '璧', '妥', '任', '混', '織', '提', '充', '緻', '科', '康', '展', '往', '乞', '栃', '購', '嚇', '適', '搾', '扶', '覚', '欲', '無', '備', '嫌', '旗', '朴', '傾', '漏', '障', '特', '換', '喝', '廃', '飽', '伯', '巻', '縛', '拳', '童', '街', '票', '否', '飢', '煙', '鎌', '症', '賊', '刑', '偽', '岸', '変', '洞', '華', '壇', '性', '県', '頼', '侮', '沃', '章', '衣', '型', '恣', '共', '早', '鼻', '工', '鐘', '替', '恐', '務', '嗅', '電', '脳', '肢', '契', '想', '賛', '歴', '幹', '妊', '卓', '辺', '訴', '武', '和', '征', '般', '同', '芝', '基', '滋', '佳', '駐', '手', '停', '灰', '可', '崖', '探', '翌', '化', '教', '向', '侯', '負', '簿', '緩', '赤', '晶', '又', '徐', '続', '紛', '諸', '震', '便', '扇', '薫', '詩', '寺', '困', '毛', '喩', '策', '塀', '価', '析', '根', '査', '札', '辱', '心', '隔', '部', '痩', '斜', '俺', '客', '池', '散', '舗', '縁', '接', '素', '摂', '陛', '視', '胃', '勲', '匹', '衷', '冶', '飾', '撲', '新', '旬', '扱', '酵', '勝', '賀', '求', '末', '棄', '摩', '紹', '導', '鼓', '柔', '謙', '課', '好', '戚', '弊', '祈', '喪', '慎', '意', '鍋', '嫡', '廷', '書', '油', '炎', '伎', '侶', '斤', '盛', '宵', '椎', '奨', '吐', '薬', '侍', '照', '重', '誠', '錮', '紺', '楷', '森', '濃', '聞', '較', '就', '礎', '握', '石', '益', '急', '建', '衡', '成', '幣', '肝', '涙', '遡', '服', '初', '曖', '弱', '瞬', '福', '揮', '昨', '壁', '休', '儀', '静', '炊', '茎', '哺', '幽', '磨', '穀', '宗', '止', '稽', '采', '姓', '砂', '墓', '呂', '縦', '頻', '雇', '謀', '安', '央', '牙', '機', '紫', '叫', '水', '潤', '峡', '屈', '触', '遺', '裾', '哀', '包', '准', '揚', '酢', '廉', '徳', '羞', '差', '憲', '似', '食', '詰', '肌', '闇', '幕', '慄', '撃', '酬', '比', '署', '剖', '蓋', '請', '留', '殉', '赴', '尚', '勉', '蜂', '遂', '贈', '溺', '収', '戻', '豪', '禅', '繁', '舷', '慢', '企', '染', '沖', '川', '長', '善', '財', '忠', '御', '民', '逆', '惑', '帰', '春', '称', '虚', '寸', '邦', '健', '膳', '痕', '日', '絶', '輝', '惧', '郵', '皮', '稼', '枯', '酎', '爵', '酒', '肺', '垣', '仙', '額', '剤', '慰', '欺', '誤', '態', '所', '膨', '娘', '陸', '芽', '隷', '輩', '漸', '算', '領', '歓', '縫', '艦', '丈', '遜', '里', '刹', '識', '狭', '淡', '抱', '墨', '凸', '恋', '滝', '泌', '暁', '遭', '荷', '談', '毒', '訳', '才', '値', '切', '杯', '州', '死', '畔', '法', '棋', '卸', '氾', '賂', '悪', '掛', '経', '迫', '倹', '刀', '孔', '模', '唆', '愁', '衛', '多', '的', '躍', '仏', '矛', '痢', '彫', '問', '霜', '魔', '餓', '奔', '器', '結', '兼', '警', '校', '綱', '痴', '現', '燥', '菌', '修', '索', '託', '傑', '仰', '破', '商', '塾', '隣', '班', '錦', '群', '挿', '等', '婆', '焼', '繰', '植', '極', '遮', '派', '島', '埼', '測', '汚', '帆', '委', '深', '願', '孝', '込', '睦', '従', '頂', '瓦', '骨', '孫', '数', '営', '魚', '渦', '憾', '胴', '来', '猛', '賠', '百', '姿', '抗', '枚', '袖', '頃', '母', '祥', '館', '師', '永', '斑', '逮', '鶴', '恥', '甚', '依', '呈', '献', '脅', '貸', '謡', '醸', '醜', '塩', '拾', '者', '励', '憎', '郷', '粗', '兵', '故', '拓', '陥', '温', '令', '朝', '裁', '終', '黒', '瞭', '串', '腺', '英', '果', '墳', '項', '閑', '引', '割', '午', '昔', '爪', '河', '竜', '融', '軟', '知', '誘', '某', '略', '並', '穫', '粧', '唇', '堂', '輸', '系', '騰', '邪', '洗', '鍛', '則', '歌', '苗', '用', '暗', '各', '輪', '酪', '妹', '地', '緯', '姫', '護', '湾', '拒', '支', '活', '含', '声', '節', '排', '験', '荒', '画', '済', '羅', '送', '憩', '胎', '域', '礁', '裕', '吹', '販', '寧', '繭', '内', '岩', '泥', '猿', '氷', '毎', '満', '決', '遵', '陣', '樹', '宜', '待', '烈', '腕', '確', '境', '上', '阜', '桃', '操', '芋', '約', '暮', '押', '綻', '一', '菊', '固', '釜', '倒', '戯', '髄', '措', '木', '阪', '尿', '机', '脂', '恒', '厚', '拘', '渡', '宝', '府', '軽', '歩', '締', '累', '痛', '賄', '感', '最', '単', '管', '三', '鈴', '述', '物', '拶', '翁', '剛', '翻', '恩', '閉', '媒', '蛇', '棺', '匂', '弐', '伴', '糧', '婚', '写', '後', '念', '宇', '郊', '浪', '寒', '陶', '関', '丹', '且', '推', '忍', '講', '貿', '緒', '察', '雌', '作', '殻', '放', '飼', '次', '途', '僧', '五', '片', '執', '賃', '怠', '何', '凍', '缶', '答', '掃', '溶', '鬱', '名', '紡', '刊', '文', '潰', '諭', '窓', '遠', '思', '臓', '燃', '拐', '敬', '夜', '迅', '誇', '拠', '著', '喉', '逸', '嵐', '悲', '郎', '詣', '貝', '村', '鋭', '目', '帝', '資', '浸', '弥', '犠', '舞', '望', '時', '牛', '奉', '寄', '砕', '招', '対', '改', '亀', '敵', '僕', '当', '微', '硝', '万', '浮', '踪', '庫', '功', '古', '罰', '届', '信', '頭', '寿', '煩', '児', '移', '堀', '看', '麺', '澄', '泣', '腰', '喜', '状', '鉱', '核', '那', '昇', '珠', '人', '枠', '辛', '司', '賓', '忘', '婿', '達', '募', '体', '如', '萎', '点', '醒', '評', '設', '程', '魅', '光', '国', '林', '泡', '交', '綿', '臨', '政', '返', '干', '辞', '軌', '貴', '曜', '胆', '脚', '救', '訪', '愛', '胞', '吉', '剣', '穴', '亜', '需', '漁', '床', '熱', '喚', '盆', '柿', '宴', '笑', '足', '塁', '窮', '符', '墾', '条', '耕', '働', '寡', '蚊', '身', '搬', '件', '擁', '享', '院', '欧', '郭', '殖', '魂', '理', '嫁', '滅', '丁', '誓', '危', '爆', '実', '慨', '罵', '怨', '棒', '狂', '売', '張', '珍', '乱', '崎', '昭', '傲', '匿', '草', '言', '伏', '瘍', '香', '玉', '速', '罷', '配', '恵', '腹', '挙', '傘', '義', '敗', '集', '認', '慶', '号', '鈍', '漫', '座', '沢', '秘', '印', '毀', '丙', '序', '唱', '洋', '苦', '銅', '字', '江', '党', '股', '囚', '習', '継', '徴', '劾', '誰', '猶', '易', '披', '保', '罪', '酌', '風', '道', '蹴', '窟', '凹', '槽', '俊', '彼', '職', '肯', '虫', '銃', '漂', '籍', '金', '険', '式', '旧', '褐', '誕', '耗', '規', '主', '尽', '獲', '哲', '命', '俗', '装', '園', '類', '妄', '残', '禁', '羊', '欄', '夏', '低', '官', '零', '潔', '況', '因', '姻', '奮', '底', '検', '犯', '憂', '屋', '宮', '培', '呪', '坂', '員', '晴', '彰', '貪', '予', '肩', '藍', '横', '邸', '餅', '巣', '富', '陽', '挫', '紋', '庸', '衰', '絵', '爽', '土', '癖', '増', '虜', '革', '栄', '硬', '使', '曇', '盤', '審', '門', '沼', '暑', '倣', '疫', '迭', '据', '蔽', '世', '怪', '宰', '𠮟', '始', '精', '良', '揺', '厘', '顔', '株', '雷', '妃', '超', '諦', '肪', '雄', '橋', '山', '璽', '褒', '難', '腫', '準', '謎', '雅', '膚', '睡', '騒', '騎', '丸', '至', '断', '劣', '両', '田', '順', '汽', '拙', '発', '計', '礼', '種', '苛', '鋳', '走', '候', '祖', '蔑', '虎', '恨', '棟', '平', '野', '諧', '顕', '線', '促', '副', '老', '隅', '逓', '材', '但', '獣', '海', '女', '曲', '店', '討', '動', '影', '閲', '兄', '閣', '訓', '倉', '抹', '巧', '藩', '鉛', '捨', '浅', '眉', '妬', '席', '曹', '瑠', '離', '車', '吸', '要', '援', '脈', '嗣', '批', '告', '守', '窃', '臆', '衝', '補', '兆', '宛', '申', '桁', '痘', '肘', '慈', '潜', '記', '必', '周', '親', '泊', '斗', '復', '帥', '父', '瓶', '嘱', '壮', '柳', '抽', '源', '勃', '維', '投', '雨', '酔', '糸', '須', '覧', '韻', '社', '庶', '克', '採', '情', '仕', '僅', '将', '翼', '弾', '詠', '方', '寝', '絞', '徒', '拝', '岡', '劇', '網', '事', '唯', '冥', '有', '矯', '丘', '駆', '肉', '抜', '漢', '渉', '篤', '暖', '筋', '尾', '斉', '被', '星', '霧', '然', '貌', '汗', '幼', '掘', '番', '間', '眼', '朕', '隙', '巡', '嫉', '悔', '治', '升', '是', '畿', '存', '年', '本', '柱', '期', '下', '畜', '介', '鋼', '八', '舎', '衆', '妙', '麗', '鑑', '別', '撮', '督', '清', '段', '反', '我', '試', '譲', '覇', '養', '剝', '量', '籠', '呼', '蛮', '挨', '界', '潮', '防', '券', '角', '供', '叔', '冗', '碁', '笛', '研', '争', '遇', '侵', '外', '独', '貢', '城', '廊', '枕', '霊', '桑', '築', '銀', '注', '粋', '夫', '夕', '壌', '泉', '総', '斎', '隠', '擬', '臣', '緊', '沸', '友', '髪', '漆', '亭', '層', '了', '沈', '滴', '豆', '炭', '垂', '組', '居', '通', '崩', '快', '湧', '仁', '偏', '乾', '帽', '抑', '凶', '墜', '南', '儒', '鶏', '録', '希', '減', '証', '捉', '添', '再', '憧', '明', '打', '詐', '子', '九', '稿', '授', '咽', '料', '皇', '湿', '捕', '俸', '踊', '貧', '谷', '穂', '畝', '縄', '標', '医', '紅', '諾', '弓', '憤', '協', '后', '直', '畏', '療', '頑', '失', '弄', '描', '塞', '械', '践', '峠', '渓', '剰', '巾', '塑', '敏', '他', '処', '雪', '氏', '係', '択', '俵', '閥', '脊', '摘', '戴', '退', '賭', '延', '勘', '攻', '坪', '腸', '博', '茂', '簡', '殺', '債', '費', '堤', '菓', '位', '響', '史', '宿', '怒', '勾', '芳', '恭', '拷', '報', '陵', '箋', '音', '搭', '悼', '入', '崇', '冷', '定', '箸', '桟', '二', '指', '履', '製', '豚', '猫', '迎', '気', '太', '強', '忙', '遊', '蚕', '瞳', '餌', '滑', '卑', '属', '船', '週', '家', '表', '茨', '勤', '紀', '惨', '壊', '遷', '拍', '雑', '圏', '朗', '与', '貯', '濫', '持', '到', '先', '生', '制', '績', '柄', '概', '悟', '舟', '虐', '及', '承', '舶', '沿', '斥', '軒', '不', '歳', '論', '避', '秒', '祭', '捜', '婦', '堅', '吏', '鉄', '幻', '典', '禍', '轄', '全', '却', '款', '秋', '偵', '冒', '語', '取', '僚', '句', '召', '戒', '聴', '勅', '景', '航', '刈', '転', '米', '艶', '釈', '謝', '晩', '距', '弔', '夢', '分', '己', '盲', '脇', '京', '品', '羽', '流', '熟', '相', '緑', '祝', '箱', '利', '幅', '円', '柵', '旨', '挑', '波', '賞', '淫', '虹', '粉', '針', '選', '淑', '腐', '短', '径', '臼', '頓', '左', '中', '尋', '稲', '飛', '還', '訃', '桜'}

def is_full_kanji(char):
    return char in joyo_kanji_set

for filename in os.listdir(input_folder):
    if filename.endswith(".svg"):
        path = os.path.join(input_folder, filename)
        tree = ET.parse(path)
        root = tree.getroot()

        kanji_id = filename.replace(".svg", "")

        # find any kvg:id attributes
        radicals = root.findall(".//*[@kvg:element]", namespaces={"kvg": "http://kanjivg.tagaini.net"})
        kanji = radicals[0].attrib.get("{http://kanjivg.tagaini.net}element")
        if not is_full_kanji(kanji): continue

        for radical in radicals[1:]:
            radical = radical.attrib.get("{http://kanjivg.tagaini.net}element")
            if radical in radical_map:
                radical_map[radical].append(kanji)
            else:
                radical_map[radical] = [kanji]

# save as JSON
with open(output_file, "w", encoding="utf-8") as f:
    json.dump(radical_map, f, ensure_ascii=False, indent=2)

print(f"✅ Extracted {len(radical_map)} kanji into {output_file}")
